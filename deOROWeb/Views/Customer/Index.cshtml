@model IEnumerable<deORODataAccess.customer>

@{
    ViewBag.Title = @deOROWeb.Resources.Strings.Customers;
}

<link href="~/Scripts/js/plugins/tooltips/simptip.css" rel="stylesheet" />

<aside class="right-side">

    <section class="content-header">
        <h1>@deOROWeb.Resources.Strings.Customers</h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i>@deOROWeb.Resources.Strings.Home</a></li>
            <li class="active">@deOROWeb.Resources.Strings.Customers</li>
        </ol>
    </section>

    <section class="content">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header">
                    <div class="margin">
                        <div class="pull-left box-tools">
                            <button class="btn btn-primary btn-flat btn-sm" data-toggle="modal" data-target="#popup-modal" id="button-add"><i class="fa  fa-plus-square"></i>&nbsp;&nbsp;@deOROWeb.Resources.Strings.Add @deOROWeb.Resources.Strings.Customer</button>
                        </div>
                    </div>
                </div>
                <div class="box-body table-responsive">
                    <table class="table table-bordered table-striped" id="grid">
                        <thead>
                            <tr>
                                <th>@deOROWeb.Resources.Strings.Name</th>
                                <th>@deOROWeb.Resources.Strings.Code</th>
                                <th>@deOROWeb.Resources.Strings.EmailAddress</th>
                                <th>@deOROWeb.Resources.Strings.Address</th>
                                <th>@deOROWeb.Resources.Strings.City</th>
                                <th>@deOROWeb.Resources.Strings.State</th>
                                <th>@deOROWeb.Resources.Strings.Zip</th>
                                <th>@deOROWeb.Resources.Strings.Phone</th>
                                <th>@deOROWeb.Resources.Strings.Fax</th>
                                <th>@deOROWeb.Resources.Strings.Active</th>
                                <th></th>
                                <th hidden="hidden"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var m in Model)
                            {
                                <tr>
                                    <td>@m.name</td>
                                    <td>@m.code</td>
                                    <td>@m.email_address</td>
                                    <td>@m.address</td>
                                    <td>@m.city</td>
                                    <td>@m.state</td>
                                    <td>@m.zip</td>
                                    <td>@m.phone</td>
                                    <td>@m.fax</td>
                                    @if (m.is_active == 1)
                                    {
                                        <td>@deOROWeb.Resources.Strings.True</td>
                                    }
                                    else
                                    {
                                        <td>@deOROWeb.Resources.Strings.False</td>
                                    }
                                    <td>
                                        <i class="fa fa-edit"><a class="btn btn-app-small" data-toggle="modal" data-target="#popup-modal" id="@m.id-edit">@deOROWeb.Resources.Strings.Edit</a></i>
                                    </td>
                                    <td hidden="hidden">
                                        <i class="fa fa-trash-o"><a class="btn btn-app-small" id="@m.id-delete" hidden="hidden">@deOROWeb.Resources.Strings.Delete</a></i>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
</aside>

<div class="modal fade" id="popup-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="modal-title"><i class="fa fa-user"></i>&nbsp;@deOROWeb.Resources.Strings.Customer</h4>
            </div>
            <form action="#" method="post" id="form-customer">
                <div class="modal-body">
                    <input id="input_hidden_action" type="hidden" />
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">@deOROWeb.Resources.Strings.CustomerName <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top" data-tooltip="Customer's Name">(?)</a> :</span>
                            <input id="input_customer_name" name="input_customer_name" class="form-control" placeholder="@deOROWeb.Resources.Strings.CustomerName" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">@deOROWeb.Resources.Strings.CustomerCode <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top" data-tooltip="Customer's identificator code for your company">(?)</a> :</span>
                            <input id="input_customer_code" name="input_customer_code" class="form-control" placeholder="@deOROWeb.Resources.Strings.CustomerCode" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>@deOROWeb.Resources.Strings.Active <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top simptip-multiline" data-tooltip="Select 'Yes' to show this customer in the system, otherwise select 'No' only to save it.">(?)</a> </label>
                        <select class="form-control" id="combo-active">
                            <option value='1' selected="selected">@deOROWeb.Resources.Strings.True</option>
                            <option value='0'>@deOROWeb.Resources.Strings.False</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">@deOROWeb.Resources.Strings.EmailAddress <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top" data-tooltip="Customer's Email">(?)</a> :</span>
                            <input id="input_email_address" name="input_email_address" class="form-control" placeholder="@deOROWeb.Resources.Strings.EmailAddress" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">@deOROWeb.Resources.Strings.Address <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top" data-tooltip="Customer's Address">(?)</a> :</span>
                            <input id="input-address" name="input-address" class="form-control" placeholder="@deOROWeb.Resources.Strings.Address" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">@deOROWeb.Resources.Strings.City <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top" data-tooltip="Costumer's City">(?)</a> :</span>
                            <input id="input-city" name="input-city" class="form-control" placeholder="@deOROWeb.Resources.Strings.City" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">@deOROWeb.Resources.Strings.State <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top" data-tooltip="Customer's State">(?)</a> :</span>
                            @*<input id="input-state" name="input-state" class="form-control" placeholder="State" required="required">*@
                            @* //===============================UNITED STATES=========================================================*@
                              <select name="combo-state" id="combo-state" class="form-control">
                              <option value="">@deOROWeb.Resources.Strings.SelectOne</option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="DC">District of Columbia</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                            </select>
                              @* //===============================MEXICO=========================================================*@
                           @* <select name="combo-state" id="combo-state" class="form-control">
                                <option value="">Select One</option>
                                <option value="AGU">Aguascalientes</option>
                                <option value="BCN">Baja California</option>
                                <option value="BCS">Baja California Sur</option>
                                <option value="CAM">Campeche</option>
                                <option value="COA">Coahuila de Zaragoza</option>
                                <option value="COL">Colima</option>
                                <option value="CHP">Chiapas</option>
                                <option value="CHH">Chihuahua</option>
                                <option value="CMX">Ciudad de México</option>
                                <option value="DIF">Distrito Federal</option>
                                <option value="DUR">Durango</option>
                                <option value="GUA">Guanajuato</option>
                                <option value="GRO">Guerrero</option>
                                <option value="HID">Hidalgo</option>
                                <option value="JAL">Jalisco</option>
                                <option value="MEX">México</option>
                                <option value="MIC">Michoacán de Ocampo</option>
                                <option value="MOR">Morelos</option>
                                <option value="NAY">Nayarit</option>
                                <option value="NLE">Nuevo León</option>
                                <option value="OAX">Oaxaca</option>
                                <option value="PUE">Puebla</option>
                                <option value="QUE">Querétaro</option>
                                <option value="ROO">Quintana Roo</option>
                                <option value="SLP">San Luis Potosí</option>
                                <option value="SIN">Sinaloa</option>
                                <option value="SON">Sonora</option>
                                <option value="TAB">Tabasco</option>
                                <option value="TAM">Tamaulipas</option>
                                <option value="TLA">Tlaxcala</option>
                                <option value="VER">Veracruz de Ignacio de la Llave</option>
                                <option value="YUC">Yucatán</option>
                                <option value="ZAC">Zacatecas</option>
                            </select>*@
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">@deOROWeb.Resources.Strings.Zip <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top" data-tooltip="Customer's Zip Code">(?)</a> :</span>
                            <input id="input-zip" name="input-zip" class="form-control" placeholder="@deOROWeb.Resources.Strings.Zip" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">@deOROWeb.Resources.Strings.Phone <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top" data-tooltip="Customer's Phone">(?)</a> :</span>
                            <input id="input-phone" name="input-phone" class="form-control" placeholder="@deOROWeb.Resources.Strings.Phone" required="required" />

                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">@deOROWeb.Resources.Strings.Fax <a style="cursor: pointer; font-weight: normal;" class="simptip-position-top" data-tooltip="Customer's Fax">(?)</a> :</span>
                            <input id="input-fax" class="form-control" placeholder="@deOROWeb.Resources.Strings.Fax">
                        </div>
                    </div>
                </div>
                <div class="modal-footer clearfix">
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i>@deOROWeb.Resources.Strings.Cancel</button>
                    <button type="submit" class="btn btn-primary pull-left" id="button-save"><i class="fa fa-save"></i>@deOROWeb.Resources.Strings.Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>


    $('#popup-modal').on('show.bs.modal', function (e) {
        $('.form-control').val('').prop('readonly', false);
        $('#combo-active').val('1');
        $('#combo-state').val('');

        $("#form-customer").validate().resetForm();
        $(".form-group").removeClass("has-error");
        $(".input").prop('readonly', false);

        $('#input-phone').mask('(000) 000-0000');
        $('#input-fax').mask('(000) 000-0000');
        $('#input-zip').mask('00000');
    })

    $.validator.setDefaults({
        highlight: function (element) {
            $(element).closest('.form-group').addClass('has-error');
        },
        unhighlight: function (element) {
            $(element).closest('.form-group').removeClass('has-error');
        },
        errorElement: 'span',
        errorClass: 'help-block',
        errorPlacement: function (error, element) {
            if (element.parent('.input-group').length) {
                error.insertAfter(element.parent());
            } else {
                error.insertAfter(element);
            }
        }
    });

    $('#form-customer').validate({
        onkeyup: false,
        rules: {
            "input_customer_name": {
                required: true,
                remote: {
                    url: "@Request.ApplicationPath/Customer/IsNameAvailable/",
                    type: "post",
                    data: {
                        input_hidden_action: function () {
                            return $('#input_hidden_action').val();
                        }
                    }

                }
            },
            "input_customer_code": {
                required: true,
                remote: {
                    url: "@Request.ApplicationPath/Customer/IsCodeAvailable/",
                    type: "post",
                    data: {
                        input_hidden_action: function () {
                            return $('#input_hidden_action').val();
                        }
                    }

                }
            },
            "input_email_address": {
                required: true,
                minlength: 6,
                email: true,
                remote: {
                    url: "@Request.ApplicationPath/Customer/IsEmailAvailable/",
                    type: "post",
                    data: {
                        input_hidden_action: function () {
                            return $('#input_hidden_action').val();
                        }
                    }

                }
            },
            "input-address": {
                required: false
            },
            "input-city": {
                required: false
            },
            "input-state": {
                required: false
            },
            "input-zip": {
                required: false
            },
            "input-phone": {
                required: false
            }
        },
        messages: {
            "input_customer_name": {
                remote: "Customer Name already in use"
            },
            "input_email_address": {
                remote: "Email Address already in use"
            },
            "input_customer_code": {
                remote: "Customer Code already in use"
            }
        }
    });

    $('#button-add').click(function (event) {
        $("#input_hidden_action").val('');
    });

    //$('.btn').click(function (event) {
    $('#grid tbody').on('click', 'tr', function (event) {

        var target = event.target.id;

        if (target.indexOf('edit') >= 0) {

            var id = target.substring(0, target.indexOf('edit') - 1);
            var postData = '{"id":' + id + '}';

            $("#input_hidden_action").val(id);

            $.ajax({
                type: "POST",
                url: "@Request.ApplicationPath/Customer/Details/",
                dataType: "json",
                cache: false,
                contentType: "application/json; charset=utf-8",
                data: postData,
                success: function (result) {

                    $('#input_customer_name').val(result.name);
                    //$('#input_customer_code').val(result.code).prop('readonly', true);
                    $('#input_customer_code').val(result.code);
                    $('#input_email_address').val(result.email_address);
                    $('#input-address').val(result.address);
                    $('#input-city').val(result.city);
                    //$('#input-state').val(result.state);
                    $("#combo-state > [value='" + result.state + "']").attr("selected", "true");
                    $('#input-zip').val(result.zip);
                    $('#input-phone').val(result.phone);
                    $('#input-fax').val(result.fax);
                    $("#combo-active > [value='" + result.is_active + "']").attr("selected", "true");

                },
                error: function (error) {
                    alert("There was an error posting the data to the server: " + error.responseText);
                }
            });
        }
        else if (target.indexOf('delete') >= 0) {

            bootbox.confirm("Are you sure you want to delete this Customer?", function (result) {

                if (result) {
                    var id = target.substring(0, target.indexOf('delete') - 1);
                    var postData = '{"id":' + id + '}';

                    $.ajax({
                        type: "POST",
                        url: "@Request.ApplicationPath/Delete/",
                        dataType: "json",
                        cache: false,
                        contentType: "application/json; charset=utf-8",
                        data: postData,
                        success: function (result) {
                        },
                        error: function (error) {
                            alert("There was an error posting the data to the server: " + error.responseText);
                        }
                    });
                }
            });
        }
    })

$('#button-save').click(function () {

    if (!$("#form-customer").valid()) return;

    var hidden = $("#input_hidden_action").val();

    var postData = JSON.stringify({

        'id': hidden,
        'name': $('#input_customer_name').val(),
        'code': $('#input_customer_code').val(),
        'email_address': $('#input_email_address').val(),
        'address': $('#input-address').val(),
        'city': $('#input-city').val(),
        //'state': $('#input-state').val(),
        'state': $('#combo-state  option:selected').val(),
        'zip': $('#input-zip').val(),
        'phone': $('#input-phone').val(),
        'fax': $('#input-fax').val(),
        'is_active': $('#combo-active  option:selected').val()

    });

    if (hidden.length > 0) { //Edit

        $.ajax({
            type: "POST",
            url: "@Request.ApplicationPath/Customer/Edit",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: postData,
            async: false,
            success: function (result) {
            },
            error: function (error) {
                //alert("There was an error posting the data to the server: " + error.responseText);
            }
        });
    } else { // Add

        $.ajax({
            type: "POST",
            url: "@Request.ApplicationPath/Customer/Create",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: postData,
            async: false,
            success: function (result) {
            },
            error: function (error) {
                //alert("There was an error posting the data to the server: " + error.responseText);
            }
        });
    }
});

//=====POSITION CHANGE OF CONVERTION OF TABLE TO JQUERY DATA TABLE AFTER ADD ALL PROPERTIES TO THE CONTROLS TO AVOID ISSUES. By Luis Ruiz

    $('#grid').dataTable({
        "language": {
            "lengthMenu": "@deOROWeb.Resources.Strings.Display _MENU_ @deOROWeb.Resources.Strings.Recordsperpage",
            "zeroRecords": "@deOROWeb.Resources.Strings.Nothingfound - @deOROWeb.Resources.Strings.Sorry",
            "info": "@deOROWeb.Resources.Strings.Showingpage _PAGE_ @deOROWeb.Resources.Strings.of _PAGES_",
            "infoEmpty": "@deOROWeb.Resources.Strings.Norecordsavailable",
            "infoFiltered": "(@deOROWeb.Resources.Strings.filteredfrom _MAX_ @deOROWeb.Resources.Strings.totalrecords)",
            "sSearch": "@deOROWeb.Resources.Strings.Search:",
            "oPaginate": {
                "sFirst": "@deOROWeb.Resources.Strings.First",
                "sLast": "@deOROWeb.Resources.Strings.Last",
                "sNext": "@deOROWeb.Resources.Strings.Next",
                "sPrevious": "@deOROWeb.Resources.Strings.Previous"
            },
        }
    });

</script>

